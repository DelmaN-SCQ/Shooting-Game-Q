<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Futuristic Shooter</title>
<style>
body {
    margin:0;
    overflow:hidden;
    font-family: 'Arial', sans-serif;
    background: radial-gradient(circle at center, #0a0a1a, #00001a);
    color:white;
}
canvas {display:block;}
#menu, #gameover {
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    text-align:center;
}
button {
    padding:15px 30px;
    font-size:20px;
    margin-top:15px;
    border:none;
    border-radius:10px;
    background:linear-gradient(90deg,#0ff,#08f);
    color:white;
    cursor:pointer;
    transition:0.3s;
    box-shadow:0 0 15px #0ff;
}
button:hover {
    box-shadow:0 0 30px #0ff;
}
#menu h1, #gameover h1 {
    font-size:48px;
    text-shadow: 0 0 15px #0ff;
}
</style>
</head>
<body>

<div id="menu">
<h1>FUTURISTIC SHOOTER</h1>
<p>Strzał: SPACJA | Ruch: Strzałki</p>
<button id="startBtn">Zagraj</button>
</div>

<div id="gameover" style="display:none;">
<h1>Przegrałeś!</h1>
<button id="restartBtn">Restart</button>
<button id="menuBtn">Menu</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

// --- Game variables ---
let gameStarted=false, gameOver=false, paused=false;

const player={x:canvas.width/2,y:canvas.height-80,width:30,height:50,speed:7,lives:100,maxLives:100,shield:false};
const bullets=[], bulletSpeed=15;
const enemies=[], maxEnemies=10, enemySpeed=2;
const powerUps=[], maxPowerUps=2;

let score=0, kills=0, shieldTimer=0;

// --- Persistent variables ---
let level=parseInt(localStorage.getItem('level'))||1;
let xp=parseInt(localStorage.getItem('xp'))||0;
let xpGoal=parseInt(localStorage.getItem('xpGoal'))||100;
let highScore=parseInt(localStorage.getItem('highScore'))||0;

// --- Controls ---
const keys={};
document.addEventListener('keydown',e=>{
    keys[e.key]=true;
    if(gameStarted && e.key===' ') shoot();
    if(e.key==='p' || e.key==='P') paused=!paused;
});
document.addEventListener('keyup',e=>keys[e.key]=false);

// --- Menu buttons ---
document.getElementById('startBtn').onclick=()=>{gameStarted=true;gameOver=false;document.getElementById('menu').style.display='none'; resetGame(false);};
document.getElementById('restartBtn').onclick=()=>{gameOver=false;gameStarted=true;document.getElementById('gameover').style.display='none'; resetGame(false);};
document.getElementById('menuBtn').onclick=()=>{gameOver=false;gameStarted=false;document.getElementById('gameover').style.display='none'; document.getElementById('menu').style.display='block';};

// --- Sounds ---
const shootSound=new Audio('https://freesound.org/data/previews/66/66717_931655-lq.mp3');
const hitSound=new Audio('https://freesound.org/data/previews/256/256113_4486188-lq.mp3');
const pickupSound=new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3');
const damageSound=new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3');

// --- Reset Game ---
function resetGame(resetPersistent=false){
    player.x=canvas.width/2; player.y=canvas.height-80; player.lives=100; player.shield=false;
    bullets.length=0; enemies.length=0; powerUps.length=0;
    score=0; kills=0; shieldTimer=0;
    if(resetPersistent){
        level=1; xp=0; xpGoal=100;
    }
}

// --- Shoot ---
function shoot(){bullets.push({x:player.x-5,y:player.y,width:10,height:20}); shootSound.currentTime=0; shootSound.play();}

// --- Spawn Enemy ---
function spawnEnemy(){
    if(enemies.length>=maxEnemies) return;
    const size=30;
    const x=Math.random()*(canvas.width-size);
    const color=['red','orange','purple','cyan'][Math.floor(Math.random()*4)];
    enemies.push({x,y:-size,width:size,height:size,hp:40,color});
}

// --- Spawn Power-up ---
function spawnPowerUp(){
    if(powerUps.length>=maxPowerUps) return;
    const size=20;
    const x=Math.random()*(canvas.width-size);
    const type=Math.random()<0.5?'life':'shield';
    powerUps.push({x,y:-size,size,type});
}

// --- Game update ---
function update(){
    if(!gameStarted||gameOver||paused) return;

    // Player movement
    if(keys['ArrowLeft'] && player.x-player.width/2>0) player.x-=player.speed;
    if(keys['ArrowRight'] && player.x+player.width/2<canvas.width) player.x+=player.speed;
    if(keys['ArrowUp'] && player.y-player.height/2>0) player.y-=player.speed;
    if(keys['ArrowDown'] && player.y+player.height/2<canvas.height) player.y+=player.speed;

    // Bullets
    for(let i=bullets.length-1;i>=0;i--){bullets[i].y-=bulletSpeed;if(bullets[i].y+bullets[i].height<0) bullets.splice(i,1);}

    // Enemies
    for(let i=enemies.length-1;i>=0;i--){
        let e=enemies[i]; e.y+=enemySpeed;
        // Bullet collision
        for(let j=bullets.length-1;j>=0;j--){
            if(bullets[j].x<e.x+e.width && bullets[j].x+bullets[j].width>e.x &&
               bullets[j].y<e.y+e.height && bullets[j].y+bullets[j].height>e.y){
                bullets.splice(j,1); e.hp-=20; hitSound.currentTime=0; hitSound.play();
                if(e.hp<=0){
                    score+=100; kills++; xp+=20;
                    if(score>=1000) xp+=30;
                    enemies.splice(i,1);
                }
                break;
            }
        }
        // Player collision
        if(!player.shield && player.x-player.width/2<e.x+e.width && player.x+player.width/2>e.x &&
           player.y-player.height/2<e.y+e.height && player.y+player.height/2>e.y){
            enemies.splice(i,1); player.lives-=20; damageSound.currentTime=0; damageSound.play();
            if(player.lives<=0){gameOver=true;gameStarted=false;document.getElementById('gameover').style.display='block';}
        }
        if(e.y>canvas.height) enemies.splice(i,1);
    }

    // Power-ups
    for(let i=powerUps.length-1;i>=0;i--){
        let p=powerUps[i]; p.y+=2;
        if(player.x-player.width/2<p.x+p.size && player.x+player.width/2>p.x &&
           player.y-player.height/2<p.y+p.size && player.y+player.height/2>p.y){
            if(p.type==='life'){player.lives=Math.min(player.lives+20,player.maxLives);}
            if(p.type==='shield'){player.shield=true; shieldTimer=600;}
            powerUps.splice(i,1); pickupSound.currentTime=0; pickupSound.play();
        }
        if(p.y>canvas.height) powerUps.splice(i,1);
    }

    // Shield timer
    if(player.shield){shieldTimer--; if(shieldTimer<=0) player.shield=false;}

    // Level up
    if(xp>=xpGoal){level++; xp-=xpGoal; xpGoal=Math.floor(xpGoal*1.5);}

    // Save persistent variables
    localStorage.setItem('level',level);
    localStorage.setItem('xp',xp);
    localStorage.setItem('xpGoal',xpGoal);
    if(score>highScore){highScore=score; localStorage.setItem('highScore',highScore);}
}

// --- Draw ---
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Background glow stars
    for(let i=0;i<50;i++){
        ctx.fillStyle='rgba(255,255,255,'+Math.random()*0.3+')';
        ctx.fillRect(Math.random()*canvas.width,Math.random()*canvas.height,2,2);
    }

    if(paused){
        ctx.font='72px Arial';
        ctx.fillStyle='white';
        ctx.textAlign='center';
        ctx.fillText('PAUZA',canvas.width/2,canvas.height/2);
        return;
    }

    // HUD
    ctx.font='22px Arial'; ctx.textAlign='right';
    ctx.fillStyle='cyan';
    ctx.fillText(`Punkty: ${score}`,canvas.width-20,30);
    ctx.fillText(`Poziom: ${level}`,canvas.width-20,60);
    ctx.fillText(`High Score: ${highScore}`,canvas.width-20,90);

    // HP Bar
    const barWidth=250;
    ctx.fillStyle='#222'; ctx.fillRect(20,canvas.height-50,barWidth,25);
    const hpGradient=ctx.createLinearGradient(20,canvas.height-50,20+barWidth,canvas.height-25);
    hpGradient.addColorStop(0,'red'); hpGradient.addColorStop(0.5,'orange'); hpGradient.addColorStop(1,'lime');
    ctx.fillStyle=hpGradient; ctx.fillRect(20,canvas.height-50,(player.lives/player.maxLives)*barWidth,25);
    ctx.strokeStyle='white'; ctx.lineWidth=2; ctx.strokeRect(20,canvas.height-50,barWidth,25);

    // XP Bar
    ctx.fillStyle='#222'; ctx.fillRect(20,canvas.height-25,barWidth,15);
    ctx.fillStyle='blue'; ctx.fillRect(20,canvas.height-25,(xp/xpGoal)*barWidth,15);
    ctx.strokeStyle='white'; ctx.strokeRect(20,canvas.height-25,barWidth,15);

    // Player
    ctx.fillStyle=player.shield?'blue':'green';
    ctx.fillRect(player.x-player.width/2,player.y-player.height/2,player.width,player.height);

    // Bullets
    ctx.fillStyle='yellow'; bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.width,b.height));

    // Enemies
    enemies.forEach(e=>{
        ctx.fillStyle=e.color; ctx.fillRect(e.x,e.y,e.width,e.height);
        ctx.fillStyle='lime'; ctx.fillRect(e.x,e.y-5,e.width*(e.hp/40),3);
    });

    // Power-ups
    powerUps.forEach(p=>{
        ctx.fillStyle=p.type==='life'?'lime':'blue';
        ctx.fillRect(p.x,p.y,p.size,p.size);
    });
}

// --- Spawn intervals ---
setInterval(()=>{if(gameStarted&&!gameOver&&!paused) spawnEnemy();},1200);
setInterval(()=>{if(gameStarted&&!gameOver&&!paused) spawnPowerUp();},15000);

// --- Game loop ---
function gameLoop(){update();draw();requestAnimationFrame(gameLoop);}
gameLoop();
</script>

</body>
</html>
