<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Shooting Game Q Neon 2D</title>
<style>
html,body{margin:0;height:100%;background:#000;font-family:Arial;overflow:hidden;}
canvas{display:block;margin:0 auto;background:#06060b;}
#hud{position:absolute;top:10px;left:10px;color:#0ff;}
#menu{position:absolute;top:0;left:0;width:100%;height:100%;
      display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,0.85);
      color:#0ff;font-size:28px;flex-direction:column;}
button{font-size:20px;padding:10px 20px;margin-top:15px;cursor:pointer;background:#111;color:#0ff;border:2px solid #0ff;border-radius:6px;}
</style>
</head>
<body>
<div id="menu">
  <div>Strzelanka Neon 2D</div>
  <button id="startBtn">START</button>
</div>
<div id="hud">
  Lives: <span id="lives">3</span> | HP: <span id="hp">100</span> | Score: <span id="score">0</span>
</div>
<canvas id="game" width="640" height="800"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// Menu startowy
const menu = document.getElementById('menu');
document.getElementById('startBtn').onclick = ()=>{menu.style.display='none'; startGame();};

let score=0, lives=3;
const elLives=document.getElementById('lives');
const elHP=document.getElementById('hp');
const elScore=document.getElementById('score');

// player
const player = {x:W/2,y:H-80,w:48,h:48,speed:5,hp:100,maxHp:100,lastShot:0,fireRate:240,rapidUntil:0,img:new Image()};
player.img.src="assets/modern/enemy_wing.png"; // uÅ¼ywamy stylu neon dla gracza

// enemies
let enemies=[], bullets=[], pickups=[], particles=[];
const keys={};
window.addEventListener('keydown', e=>keys[e.key]=true);
window.addEventListener('keyup', e=>keys[e.key]=false);

// load sprites
const enemyImgs=["enemy_tri.png","enemy_dia.png","enemy_hex.png","enemy_wing.png"].map(f=>{
  let i=new Image(); i.src="assets/modern/"+f; return i;
});
const projImg = new Image(); projImg.src="assets/modern/proj.png";
const powerImg = new Image(); powerImg.src="assets/modern/powerup.png";
const explosionSheet = new Image(); explosionSheet.src="assets/modern/explosion_sheet.png";
const expFrames = 16;

// audio
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
function playSound(freq=700){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type="sine"; o.frequency.value=freq; g.gain.value=0.15;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+0.2);
}

// stars
const stars = Array.from({length:120},()=>({x:Math.random()*W,y:Math.random()*H,s:Math.random()*2}));

function spawnBullet(x,y,dx=0,dy=-8,owner="player"){bullets.push({x,y,dx,dy,owner,w:32,h:32});}
function spawnEnemy(){
  const t = Math.random();
  let e={x:Math.random()*(W-64),y:-64,w:64,h:64,hp:1,type:0,t:0};
  if(t<0.6){e.type=0;e.hp=1;}
  else if(t<0.85){e.type=1;e.hp=2;}
  else {e.type=2;e.hp=3;}
  enemies.push(e);
}
function spawnPickup(x,y,k){pickups.push({x,y,w:32,h:32,vy:2,kind:k});}
function spawnExplosion(x,y,count=16){
  for(let i=0;i<count;i++) particles.push({x,y,frame:0,max:expFrames,life:12+i,vy:(Math.random()-0.5)*4,vx:(Math.random()-0.5)*4});
}

function coll(a,b){return a.x<a.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;}

let last = performance.now();
function update(dt){
  // stars
  stars.forEach(s=>{s.y+=dt*40;if(s.y>H)s.y=0;});
  // player movement
  if(keys["ArrowLeft"]) player.x-=player.speed;
  if(keys["ArrowRight"]) player.x+=player.speed;
  player.x=Math.max(10,Math.min(W-10,player.x));
  // shooting
  const now=performance.now();
  const rate = now<player.rapidUntil?80:player.fireRate;
  if(keys[" "] && now-player.lastShot>rate){spawnBullet(player.x-10,player.y-20); spawnBullet(player.x+10,player.y-20); playSound(900); player.lastShot=now;}
  // bullets
  bullets.forEach(b=>{b.x+=b.dx*dt*60; b.y+=b.dy*dt*60;});
  bullets = bullets.filter(b=>b.y>-50 && b.y<H+50);
  // spawn enemies
  if(Math.random()<0.02) spawnEnemy();
  // enemies update
  enemies.forEach((e,ei)=>{
    if(e.type==0) e.y+=2*dt*60;
    else if(e.type==1){e.t+=dt*60;e.y+=1.5*dt*60;e.x+=Math.sin(e.t*0.1)*3;}
    else{e.t+=dt*60;e.y+=1*dt*60;if(e.t>100){spawnBullet(e.x+e.w/2,e.y+e.h/2,0,4,"enemy"); e.t=0; playSound(200);}}
    bullets.forEach(bi=>{if(bi.owner=="player" && coll(bi,e)){e.hp--;bi.dead=true;spawnExplosion(bi.x,bi.y,8);score+=10; if(e.hp<=0){enemies.splice(ei,1);}}});
  });
  enemies=enemies.filter(e=>e.y<H+80);
  bullets=bullets.filter(b=>!b.dead);
  // pickups
  pickups.forEach((p,i)=>{p.y+=p.vy;if(coll(p,player)){if(p.kind=="hp")player.hp=Math.min(player.maxHp,player.hp+40); else player.rapidUntil=performance.now()+1500; pickups.splice(i,1);}});
  // particles
  particles.forEach(p=>{p.x+=p.vx; p.y+=p.vy; p.frame++;});
  particles=particles.filter(p=>p.frame<p.max);
  // HUD
  elScore.textContent=score;
  elLives.textContent=lives;
  elHP.textContent=Math.floor(player.hp);
}

function draw(){
  ctx.clearRect(0,0,W,H);
  // stars
  ctx.fillStyle="#0ff"; stars.forEach(s=>ctx.fillRect(s.x,s.y,s.s,s.s));
  // player
  ctx.drawImage(player.img,player.x-player.w/2,player.y-player.h/2,player.w,player.h);
  // bullets
  bullets.forEach(b=>ctx.drawImage(projImg,b.x,b.y,b.w,b.h));
  // enemies
  enemies.forEach(e=>ctx.drawImage(enemyImgs[e.type],e.x,e.y,e.w,e.h));
  // pickups
  pickups.forEach(p=>ctx.drawImage(powerImg,p.x,p.y,p.w,p.h));
  // particles (explosion)
  particles.forEach(p=>{
    let f = Math.floor(p.frame);
    ctx.drawImage(explosionSheet,f*64,0,64,64,p.x-32,p.y-32,64,64);
  });
}

function loop(now){
  const dt=(now-last)/1000;
  last=now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}

function startGame(){last=performance.now(); loop(last);}
</script>
</body>
</html>
