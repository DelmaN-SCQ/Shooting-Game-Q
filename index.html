<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strzelanka z Animacjami i Dźwiękiem</title>
<style>
    body {
        margin: 0;
        background: #111;
        overflow: hidden;
        font-family: Arial, sans-serif;
        color: white;
    }
    canvas {
        display: block;
        margin: auto;
        background: #222;
    }
    #ui {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 20px;
        text-align: center;
    }
</style>
</head>
<body>
<div id="ui">Punkty: <span id="score">0</span> | Życia: <span id="lives">3</span></div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- Sprites ---
const playerSprite = new Image();
playerSprite.src = 'https://i.imgur.com/3W6Yf6P.png'; // sprite sheet gracza

const enemySprite = new Image();
enemySprite.src = 'https://i.imgur.com/7UuMZft.png'; // sprite sheet wroga

const bulletImg = new Image();
bulletImg.src = 'https://i.imgur.com/htQ5X0c.png'; // pocisk

// --- Dźwięki ---
const shootSound = new Audio('https://freesound.org/data/previews/66/66717_931655-lq.mp3'); // strzał
const hitSound = new Audio('https://freesound.org/data/previews/256/256113_4486188-lq.mp3'); // trafienie wroga
const damageSound = new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3'); // uderzenie gracza

// --- Gracz ---
const player = {
    x: canvas.width/2 - 25,
    y: canvas.height - 80,
    width: 50,
    height: 50,
    speed: 7,
    lives: 3,
    frameX: 0,
    maxFrame: 3,
    frameTimer: 0,
    frameInterval: 10
};

// --- Pociski ---
const bullets = [];
const bulletSpeed = 12;

// --- Wrogowie ---
const enemies = [];
const enemySpeed = 2;
let spawnInterval = 1000;

// --- Punkty ---
let score = 0;

// --- Sterowanie ---
const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);
document.addEventListener('keydown', e => {
    if(e.key === ' ') shoot();
});

// --- Funkcje ---
function shoot() {
    bullets.push({x: player.x + player.width/2 - 5, y: player.y, width: 10, height: 20});
    shootSound.currentTime = 0;
    shootSound.play();
}

function spawnEnemy() {
    const size = 50;
    const x = Math.random() * (canvas.width - size);
    enemies.push({x, y: -size, width: size, height: size, frameX: 0, maxFrame: 3, frameTimer: 0, frameInterval: 15});
}

setInterval(spawnEnemy, spawnInterval);

function update() {
    // Ruch gracza
    if(keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
    if(keys['ArrowRight'] && player.x + player.width < canvas.width) player.x += player.speed;
    if(keys['ArrowUp'] && player.y > 0) player.y -= player.speed;
    if(keys['ArrowDown'] && player.y + player.height < canvas.height) player.y += player.speed;

    // Animacja gracza
    player.frameTimer++;
    if(player.frameTimer >= player.frameInterval){
        player.frameTimer = 0;
        player.frameX++;
        if(player.frameX > player.maxFrame) player.frameX = 0;
    }

    // Ruch pocisków
    for(let i = bullets.length-1; i>=0; i--) {
        bullets[i].y -= bulletSpeed;
        if(bullets[i].y + bullets[i].height < 0) bullets.splice(i,1);
    }

    // Ruch wrogów i animacja
    for(let i = enemies.length-1; i>=0; i--) {
        let enemy = enemies[i];
        enemy.y += enemySpeed;

        // Animacja wroga
        enemy.frameTimer++;
        if(enemy.frameTimer >= enemy.frameInterval){
            enemy.frameTimer = 0;
            enemy.frameX++;
            if(enemy.frameX > enemy.maxFrame) enemy.frameX = 0;
        }

        // Kolizje z pociskami
        for(let j = bullets.length-1; j>=0; j--) {
            if(bullets[j].x < enemy.x + enemy.width &&
               bullets[j].x + bullets[j].width > enemy.x &&
               bullets[j].y < enemy.y + enemy.height &&
               bullets[j].y + bullets[j].height > enemy.y) {
                   bullets.splice(j,1);
                   enemies.splice(i,1);
                   score += 10;
                   document.getElementById('score').innerText = score;
                   hitSound.currentTime = 0;
                   hitSound.play();
                   break;
            }
        }

        // Kolizja z graczem
        if(enemy &&
           player.x < enemy.x + enemy.width &&
           player.x + player.width > enemy.x &&
           player.y < enemy.y + enemy.height &&
           player.y + player.height > enemy.y) {
               enemies.splice(i,1);
               player.lives--;
               document.getElementById('lives').innerText = player.lives;
               damageSound.currentTime = 0;
               damageSound.play();
               if(player.lives <= 0){
                   alert("Koniec gry! Punkty: " + score);
                   window.location.reload();
               }
        }

        // Wrogowie poza ekranem
        if(enemy && enemy.y > canvas.height) enemies.splice(i,1);
    }
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Gracz
    ctx.drawImage(playerSprite, player.frameX * player.width, 0, player.width, player.height,
                  player.x, player.y, player.width, player.height);

    // Pociski
    bullets.forEach(b => ctx.drawImage(bulletImg, b.x, b.y, b.width, b.height));

    // Wrogowie
    enemies.forEach(e => {
        ctx.drawImage(enemySprite, e.frameX * e.width, 0, e.width, e.height,
                      e.x, e.y, e.width, e.height);
    });
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
