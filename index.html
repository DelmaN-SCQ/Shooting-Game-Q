<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strzelanka Arcade</title>
<style>
    body {
        margin: 0;
        background: #111;
        overflow: hidden;
        font-family: Arial, sans-serif;
    }
    canvas {
        display: block;
        margin: auto;
        background: #000;
    }
    #ui {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 300px;
        text-align: center;
        color: white;
    }
    #score { font-size: 24px; font-weight: bold; }
    #level { font-size: 18px; margin-top: 5px; }
    #health-bar-container {
        width: 100%;
        height: 20px;
        background: #555;
        border-radius: 10px;
        margin-top: 10px;
        overflow: hidden;
    }
    #health-bar {
        height: 100%;
        background: limegreen;
        width: 100%;
        transition: width 0.2s;
    }
</style>
</head>
<body>
<div id="ui">
    <div>Punkty: <span id="score">0</span></div>
    <div id="level">Poziom: <span id="current-level">1</span></div>
    <div id="health-bar-container">
        <div id="health-bar"></div>
    </div>
</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- Sprity PNG ---
const playerSprite = new Image();
playerSprite.src = 'https://i.imgur.com/3W6Yf6P.png'; // sprite gracza

const enemySprites = [
    'https://i.imgur.com/7UuMZft.png', // typ 1
    'https://i.imgur.com/2p4l4iK.png', // typ 2
];

const bulletImg = new Image();
bulletImg.src = 'https://i.imgur.com/htQ5X0c.png'; // pocisk

// --- Dźwięki ---
const shootSound = new Audio('https://freesound.org/data/previews/66/66717_931655-lq.mp3');
const hitSound = new Audio('https://freesound.org/data/previews/256/256113_4486188-lq.mp3');
const damageSound = new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3');

// --- Gracz ---
const player = {
    x: canvas.width/2 - 25,
    y: canvas.height - 80,
    width: 50,
    height: 50,
    speed: 7,
    lives: 3,
    maxLives: 3,
    frameX: 0,
    maxFrame: 3,
    frameTimer: 0,
    frameInterval: 10
};

// --- Pociski ---
const bullets = [];
const bulletSpeed = 12;

// --- Wrogowie ---
const enemies = [];
let enemySpeed = 2;
let spawnInterval = 1000;

// --- Poziomy i punkty ---
let score = 0;
let level = 1;
let levelTimer = 0;

// --- Sterowanie ---
const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);
document.addEventListener('keydown', e => { if(e.key===' ') shoot(); });

// --- Funkcje ---
function shoot() {
    bullets.push({x: player.x + player.width/2 - 5, y: player.y, width: 10, height: 20});
    shootSound.currentTime = 0;
    shootSound.play();
}

function spawnEnemy() {
    const type = Math.floor(Math.random() * enemySprites.length);
    const sprite = new Image();
    sprite.src = enemySprites[type];

    const size = 50 + Math.random()*30; // różne rozmiary wrogów
    const x = Math.random() * (canvas.width - size);
    enemies.push({
        x, y: -size, width: size, height: size,
        frameX: 0, maxFrame: 3, frameTimer: 0, frameInterval: 15,
        sprite
    });
}

setInterval(spawnEnemy, spawnInterval);

function update() {
    // Poziom i trudność
    levelTimer++;
    if(levelTimer > 600){ // co 10s
        level++;
        enemySpeed += 0.5;
        spawnInterval = Math.max(300, spawnInterval - 50);
        document.getElementById('current-level').innerText = level;
        levelTimer = 0;
    }

    // Ruch gracza
    if(keys['ArrowLeft'] && player.x>0) player.x -= player.speed;
    if(keys['ArrowRight'] && player.x+player.width<canvas.width) player.x += player.speed;
    if(keys['ArrowUp'] && player.y>0) player.y -= player.speed;
    if(keys['ArrowDown'] && player.y+player.height<canvas.height) player.y += player.speed;

    // Animacja gracza
    player.frameTimer++;
    if(player.frameTimer>=player.frameInterval){
        player.frameTimer=0;
        player.frameX++;
        if(player.frameX>player.maxFrame) player.frameX=0;
    }

    // Pociski
    for(let i=bullets.length-1;i>=0;i--){
        bullets[i].y -= bulletSpeed;
        if(bullets[i].y+bullets[i].height<0) bullets.splice(i,1);
    }

    // Wrogowie
    for(let i=enemies.length-1;i>=0;i--){
        let e = enemies[i];
        e.y += enemySpeed;

        // Animacja wroga
        e.frameTimer++;
        if(e.frameTimer>=e.frameInterval){
            e.frameTimer=0;
            e.frameX++;
            if(e.frameX>e.maxFrame) e.frameX=0;
        }

        // Kolizja z pociskami
        for(let j=bullets.length-1;j>=0;j--){
            if(bullets[j].x < e.x+e.width &&
               bullets[j].x+bullets[j].width > e.x &&
               bullets[j].y < e.y+e.height &&
               bullets[j].y+bullets[j].height > e.y){
                   bullets.splice(j,1);
                   enemies.splice(i,1);
                   score+=10;
                   document.getElementById('score').innerText = score;
                   hitSound.currentTime=0; hitSound.play();
                   break;
            }
        }

        // Kolizja z graczem
        if(e &&
           player.x<e.x+e.width &&
           player.x+player.width>e.x &&
           player.y<e.y+e.height &&
           player.y+player.height>e.y){
               enemies.splice(i,1);
               player.lives--;
               document.getElementById('health-bar').style.width=(player.lives/player.maxLives*100)+'%';
               damageSound.currentTime=0; damageSound.play();

               // Efekt uderzenia
               ctx.fillStyle='rgba(255,0,0,0.3)';
               ctx.fillRect(0,0,canvas.width,canvas.height);

               if(player.lives<=0){
                   alert("Koniec gry! Punkty: "+score);
                   window.location.reload();
               }
        }

        if(e && e.y>canvas.height) enemies.splice(i,1);
    }
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Gracz
    ctx.drawImage(playerSprite, player.frameX*player.width,0,player.width,player.height,
                  player.x,player.y,player.width,player.height);

    // Pociski
    bullets.forEach(b=>ctx.drawImage(bulletImg,b.x,b.y,b.width,b.height));

    // Wrogowie
    enemies.forEach(e=>ctx.drawImage(e.sprite,e.frameX*e.width,0,e.width,e.height,
                                     e.x,e.y,e.width,e.height));
}

function gameLoop(){
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
