<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SGQ Beta</title>

<style>
body {
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    color: white;
    font-family: Arial;
}

canvas {
    background: black;
}

/* MENU START */
#menu {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
}

button {
    padding: 10px 25px;
    font-size: 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
button:hover { background: #333; color: white; }

/* HUD */
#hud {
    position:absolute;
    top: 10px;
    width: 100%;
    text-align:center;
    display:flex;
    justify-content:space-between;
    padding: 0 20px;
}

/* Pasek HP gracza */
#playerHPcontainer {
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    width:300px;
    height:20px;
    background:#333;
    border-radius:10px;
}
#playerHP {
    height:100%;
    width:100%;
    background:lime;
    border-radius:10px;
}
</style>
</head>

<body>

<div id="menu">
    <h1>SGQ Beta</h1>
    <p>Wybierz poziom trudności:</p>
    <button onclick="startGame(1)">Łatwy</button>
    <button onclick="startGame(2)">Średni</button>
    <button onclick="startGame(3)">Trudny</button>
</div>

<div id="hud">
    <div id="score">Punkty: 0</div>
    <div id="lives">Tarcza: 0</div>
</div>

<!-- Pasek HP -->
<div id="playerHPcontainer"><div id="playerHP"></div></div>

<canvas id="gameCanvas" width="700" height="500"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let difficulty = 1;
let score = 0;
let shields = 0;
let playerHP = 100;

let player;
let bullets = [];
let enemies = [];
let enemySpawnTimer = 0;

let explosions = [];
let loot = [];

let left = false;
let right = false;

document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft") left = true;
    if (e.key === "ArrowRight") right = true;
});
document.addEventListener("keyup", e => {
    if (e.key === "ArrowLeft") left = false;
    if (e.key === "ArrowRight") right = false;
});
document.addEventListener("click", shoot);

let shootSound = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
let hitSound   = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
let pickSound  = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

function startGame(diff) {
    difficulty = diff;
    score = 0;
    shields = 0;
    playerHP = 100;

    bullets = [];
    enemies = [];
    loot = [];
    explosions = [];

    document.getElementById("score").textContent = "Punkty: 0";
    document.getElementById("lives").textContent = "Tarcza: 0";
    updatePlayerHP();

    player = {
        x: canvas.width/2 - 20,
        y: canvas.height - 60,
        w: 40,
        h: 20,
        speed: 6
    };

    document.getElementById("menu").style.display = "none";

    gameLoop();
}

function shoot() {
    bullets.push({
        x: player.x + player.w/2 - 2,
        y: player.y,
        w: 4,
        h: 10,
        speed: 8
    });

    shootSound.play();
}

function spawnEnemy() {
    enemies.push({
        x: Math.random() * (canvas.width - 40),
        y: -20,
        w: 40,
        h: 20,
        speed: 1 + difficulty * 1.4,
        hp: 30 + difficulty * 20,
        maxhp: 30 + difficulty * 20
    });
}

function updatePlayerHP() {
    document.getElementById("playerHP").style.width = playerHP + "%";
    if (playerHP < 60) document.getElementById("playerHP").style.background = "yellow";
    if (playerHP < 30) document.getElementById("playerHP").style.background = "red";
}

function addExplosion(x, y) {
    explosions.push({
        x, y,
        r: 5,
        maxR: 25,
        alpha: 1
    });
}

function update() {
    if (left && player.x > 0) player.x -= player.speed;
    if (right && player.x < canvas.width - player.w) player.x += player.speed;

    bullets = bullets.filter(b => b.y > -20);
    bullets.forEach(b => b.y -= b.speed);

    enemies.forEach((e, i) => {
        e.y += e.speed;

        if (e.y > canvas.height + 50) {
            enemies.splice(i, 1);
        }
    });

    loot.forEach((l, i) => {
        l.y += 2;
        if (l.y > canvas.height) loot.splice(i, 1);

        if (
            l.x < player.x + player.w &&
            l.x + l.size > player.x &&
            l.y < player.y + player.h &&
            l.y + l.size > player.y
        ) {
            shields++;
            document.getElementById("lives").textContent = "Tarcza: " + shields;
            pickSound.play();
            loot.splice(i, 1);
        }
    });

    enemies.forEach((e, i) => {
        bullets.forEach((b, j) => {
            if (
                b.x < e.x + e.w &&
                b.x + b.w > e.x &&
                b.y < e.y + e.h &&
                b.y + b.h > e.y
            ) {
                e.hp -= 30;
                bullets.splice(j, 1);

                if (e.hp <= 0) {
                    score++;
                    document.getElementById("score").textContent = "Punkty: " + score;

                    addExplosion(e.x + e.w/2, e.y + e.h/2);
                    hitSound.play();

                    if (Math.random() < 0.35) {
                        loot.push({
                            x: e.x + e.w/2,
                            y: e.y,
                            size: 15
                        });
                    }

                    enemies.splice(i, 1);
                }
            }
        });
    });

    explosions = explosions.filter(ex => ex.r < ex.maxR);
    explosions.forEach(ex => {
        ex.r += 2;
        ex.alpha -= 0.04;
    });

    enemySpawnTimer++;
    if (enemySpawnTimer > 55 - difficulty * 10) {
        spawnEnemy();
        enemySpawnTimer = 0;
    }
}

function drawHPBar(x, y, w, h, hp, maxhp) {
    ctx.fillStyle = "red";
    ctx.fillRect(x, y - 8, w, 5);
    ctx.fillStyle = "lime";
    ctx.fillRect(x, y - 8, w * (hp/maxhp), 5);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "lime";
    ctx.fillRect(player.x, player.y, player.w, player.h);

    ctx.fillStyle = "yellow";
    bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

    enemies.forEach(e => {
        ctx.fillStyle = "red";
        ctx.fillRect(e.x, e.y, e.w, e.h);
        drawHPBar(e.x, e.y, e.w, e.h, e.hp, e.maxhp);
    });

    ctx.fillStyle = "cyan";
    loot.forEach(l => ctx.fillRect(l.x, l.y, l.size, l.size));

    explosions.forEach(ex => {
        ctx.beginPath();
        ctx.arc(ex.x, ex.y, ex.r, 0, Math.PI*2);
        ctx.fillStyle = `rgba(255,150,0,${ex.alpha})`;
        ctx.fill();
    });
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}
</script>

</body>
</html>
