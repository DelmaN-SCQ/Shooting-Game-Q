<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<title>Space Shooter Deluxe</title>
<style>
    body {
        margin: 0;
        background: #000;
        overflow: hidden;
        font-family: Arial, sans-serif;
        color: white;
    }
    #ui {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 10;
        font-size: 20px;
    }
    #menu, #settings, #gameover {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(0,0,0,0.7);
        color: white;
        z-index: 20;
    }
    button {
        padding: 14px 26px;
        margin: 10px;
        font-size: 18px;
        cursor: pointer;
        border-radius: 8px;
        border: none;
    }
</style>
</head>
<body>

<div id="ui">
    Score: <span id="score">0</span><br>
    Level: <span id="level">1</span><br>
    HighScore: <span id="hs">0</span>
</div>

<canvas id="game"></canvas>

<div id="menu">
    <h1>Space Shooter Deluxe</h1>
    <button onclick="startGame()">Zagraj</button>
    <button onclick="document.getElementById('settings').style.display='flex'">Ustawienia</button>
</div>

<div id="settings" style="display:none;">
    <h2>Ustawienia</h2>
    <button onclick="document.getElementById('settings').style.display='none'">Powr√≥t</button>
</div>

<div id="gameover" style="display:none;">
    <h1>Koniec gry!</h1>
    <p>Wynik: <span id="finalScore">0</span></p>
    <button onclick="location.reload()">Zagraj ponownie</button>
</div>

<script>
// === CANVAS ===
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// === PLAYER ===
const player = {
    x: canvas.width / 2,
    y: canvas.height - 150,
    speed: 6,
    width: 40,
    height: 40,
    lives: 100,
    maxLives: 100,
    shield: false
};

// === GAME STATE ===
let bullets = [];
let enemies = [];
let powerUps = [];
let gameStarted = false;
let paused = false;
let gameOver = false;

let score = 0;
let highScore = Number(localStorage.getItem("fs_high") || 0);
let level = 1;
let xp = 0;
let xpGoal = 100;

document.getElementById("hs").innerText = highScore;

// === BULLETS ===
function fire() {
    bullets.push({ x: player.x - 4, y: player.y - 20, w: 8, h: 16, speed: 10 });
}

// === ENEMIES ===
function spawnEnemy() {
    enemies.push({
        x: Math.random() * (canvas.width - 40),
        y: -60,
        width: 40,
        height: 40,
        hp: 40,
        maxHp: 40,
        flash: 0,
        color: "#ff3838"
    });
}
setInterval(spawnEnemy, 1000);

// === POWERUPS ===
function spawnPowerup() {
    powerUps.push({
        x: Math.random() * (canvas.width - 30),
        y: -40,
        size: 30,
        type: Math.random() < 0.5 ? "life" : "shield",
        pulse: 0
    });
}
setInterval(spawnPowerup, 6000);

// === START ===
function startGame() {
    document.getElementById("menu").style.display = "none";
    gameStarted = true;
}

// === UPDATE ===
function update() {
    if (!gameStarted || gameOver || paused) return;

    // movement
    if (keys["ArrowLeft"]) player.x -= player.speed;
    if (keys["ArrowRight"]) player.x += player.speed;
    if (keys["ArrowUp"]) player.y -= player.speed;
    if (keys["ArrowDown"]) player.y += player.speed;

    // clamp
    player.x = Math.max(20, Math.min(canvas.width - 20, player.x));
    player.y = Math.max(20, Math.min(canvas.height - 20, player.y));

    // bullets
    for (let i = bullets.length - 1; i >= 0; i--) {
        bullets[i].y -= bullets[i].speed;
        if (bullets[i].y < -50) bullets.splice(i, 1);
    }

    // enemies
    for (let i = enemies.length - 1; i >= 0; i--) {
        let e = enemies[i];
        e.y += 3;

        // hit by bullet
        for (let j = bullets.length - 1; j >= 0; j--) {
            let b = bullets[j];
            if (b.x < e.x + e.width &&
                b.x + b.w > e.x &&
                b.y < e.y + e.height &&
                b.y + b.h > e.y) {

                bullets.splice(j, 1);
                e.hp -= 20;
                e.flash = 4;

                if (e.hp <= 0) {
                    score += 100;
                    xp += 20;

                    if (score > highScore) {
                        highScore = score;
                        localStorage.setItem("fs_high", highScore);
                    }

                    enemies.splice(i, 1);
                }
            }
        }

        // collision with player
        if (
            player.x - 20 < e.x + e.width &&
            player.x + 20 > e.x &&
            player.y - 20 < e.y + e.height &&
            player.y + 20 > e.y
        ) {
            player.lives -= 20;
            enemies.splice(i, 1);

            if (player.lives <= 0) {
                gameOver = true;
                document.getElementById("finalScore").innerText = score;
                document.getElementById("gameover").style.display = "flex";
            }
        }

        if (e.y > canvas.height + 100) enemies.splice(i, 1);
    }
}

// === DRAW ===
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // background
    let g = ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0,"#0a0f18");
    g.addColorStop(1,"#000000");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // score
    document.getElementById("score").innerText = score;
    document.getElementById("level").innerText = level;
    document.getElementById("hs").innerText = highScore;

    // PLAYER (rakieta DELUXE pixel-art)
    {
        ctx.save();
        ctx.translate(player.x, player.y);
        ctx.imageSmoothingEnabled = false;

        const p = 2;

        const sprite = [
"00000022000000",
"00000222220000",
"00002222222000",
"000222dd222000",
"0022dddddd2200",
"0022ddd7ddd2200",
"0222d77777d2220",
"0222d77777d2220",
"0222d77777d2220",
"0022d77777d2200",
"002277777772200",
"000277777772000",
"000277777772000",
"000277777772000",
"000277777772000",
"000277777772000",
"000277777772000",
"000277777772000",
"0002dd7777d2000",
"0002dd7777d2000",
"0002dd7777d2000",
"0002dd7777d2000",
"00002d777d20000",
"00002d777d20000",
"00002ffff200000",
"0002fffffff2000",
"002ffffffffff200",
"0002fffffff2000",
        ];

        const colors = {
            "2": "#ffffff",
            "d": "#ffd86b",
            "7": "#ffb92d",
            "f": "#4aa7ff"
        };

        for (let y = 0; y < sprite.length; y++) {
            for (let x = 0; x < sprite[y].length; x++) {
                const px = sprite[y][x];
                if (px !== "0") {
                    ctx.fillStyle = colors[px];
                    ctx.fillRect((x - 7) * p, (y - 15) * p, p, p);
                }
            }
        }

        ctx.restore();
    }

    // bullets
    ctx.fillStyle = "#ffe66d";
    bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

    // enemies
    enemies.forEach(e => {
        if (e.flash > 0) {
            ctx.fillStyle = "#ffffff";
            e.flash--;
        } else {
            ctx.fillStyle = e.color;
        }
        ctx.fillRect(e.x, e.y, e.width, e.height);
    });
}

// === LOOP ===
setInterval(() => {
    update();
    draw();
}, 16);

// === INPUT ===
const keys = {};
onkeydown = e => {
    keys[e.key] = true;
    if (e.key === " ") fire();
};
onkeyup = e => keys[e.key] = false;

</script>
</body>
</html>
