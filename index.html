<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Futuristic Shooter — Pro (enhanced)</title>
<style>
/* Twój oryginalny CSS zostaje bez większych zmian */
:root{--bg1:#071025; --bg2:#000814; --accent:#1de9b6; --accent2:#66fcf1; --muted:#9aa5b1;}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));font-family:Inter,Arial,Helvetica,sans-serif;color:#e6f7ff;}
canvas{display:block;width:100vw;height:100vh;}
/* reszta CSS z oryginału... */
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<!-- HUD, menu, pause overlay, gameover overlay, settings panel pozostają takie same -->

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resize(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener('resize', resize, {passive:true});
resize();

/* -------------------------
   Stan gry i konfiguracja
------------------------- */
let level = parseInt(localStorage.getItem('fs_level')) || 1;
let xp = parseInt(localStorage.getItem('fs_xp')) || 0;
let xpGoal = parseInt(localStorage.getItem('fs_xpGoal')) || 100;
let highScore = parseInt(localStorage.getItem('fs_high')) || 0;
let gameStarted=false, gameOver=false, paused=false;
let score=0, kills=0;
const maxEnemies=12, maxPowerUps=3;
let spawnRate=1200, enemyHP=40;
let shieldTimer=0, doubleShotTimer=0;

/* -------------------------
   Sprites (jak wcześniej)
------------------------- */
/* playerImg, bulletImg, enemyImg generowane tak samo */

/* -------------------------
   Gracz i tablice
------------------------- */
const player={x:canvas.width/2,y:canvas.height-110,width:48,height:64,speed:7,lives:100,maxLives:100,shield:false};
const bullets=[];
const enemies=[];
const powerUps=[];

/* -------------------------
   Audio (WebAudio) pozostaje
------------------------- */

/* -------------------------
   Ustawienia HUD / UI
------------------------- */
function updateHUD(){
  document.getElementById('hudScore').innerText=score;
  document.getElementById('hudLevel').innerText=level;
  document.getElementById('hudHS').innerText=highScore;
}

/* -------------------------
   Spawnowanie wrogów/powerupów
------------------------- */
function spawnEnemy(){
  if(enemies.length>=maxEnemies) return;
  const size=36+Math.random()*26;
  const x=Math.random()*(canvas.width-size);
  const color=['#ff6b6b','#ffb86b','#b86bff','#6bd9ff'][Math.floor(Math.random()*4)];
  const angle=Math.random()*Math.PI*2;
  enemies.push({x,y:-size,width:size,height:size,hp:enemyHP,maxHp:enemyHP,color,flash:0,angle});
}

function spawnPowerup(){
  if(powerUps.length>=maxPowerUps) return;
  const size=20;
  const x=Math.random()*(canvas.width-size);
  const typeRand=Math.random();
  let type='life';
  if(typeRand<0.35) type='shield';
  else if(typeRand<0.7) type='doubleShot';
  powerUps.push({x,y:-size,size,type,pulse:Math.random()*Math.PI*2});
}

/* jeden spawner wrogów */
let enemySpawner=setInterval(()=>{if(gameStarted && !paused && !gameOver) spawnEnemy();}, spawnRate);
let powerSpawner=setInterval(()=>{if(gameStarted && !paused && !gameOver) spawnPowerup();}, 15000);
function refreshSpawner(){
  clearInterval(enemySpawner);
  enemySpawner=setInterval(()=>{if(gameStarted && !paused && !gameOver) spawnEnemy();}, spawnRate);
}

/* -------------------------
   Strzelanie gracza z double-shot
------------------------- */
function fire(){
  if(doubleShotTimer>0){
    bullets.push({x:player.x-18,y:player.y-28,w:12,h:28,speed:18});
    bullets.push({x:player.x+6,y:player.y-28,w:12,h:28,speed:18});
  } else {
    bullets.push({x:player.x-8,y:player.y-28,w:12,h:28,speed:18});
  }
  soundShoot();
}

/* -------------------------
   Start gry
------------------------- */
function startGame(demo=false){
  gameStarted=true; gameOver=false; paused=false;
  document.getElementById('menu').style.display='none';
  document.getElementById('gameover').style.display='none';
  if(demo){score=500; xp+=10;}
  player.x=canvas.width/2; player.y=canvas.height-110; player.lives=100; player.shield=false;
  bullets.length=0; enemies.length=0; powerUps.length=0;
  shieldTimer=0; doubleShotTimer=0;
  updateHUD();
  refreshSpawner();
}

/* -------------------------
   Pause
------------------------- */
function togglePause(state){
  paused=(typeof state==='boolean')?state:!paused;
  document.getElementById('pauseOverlay').style.display=paused?'flex':'none';
}

/* -------------------------
   Input handling
------------------------- */
const keys={};
addEventListener('keydown',e=>{
  if(e.key===' '){ e.preventDefault(); if(gameStarted && !paused && !gameOver) fire();}
  if(e.key==='p'||e.key==='P') togglePause();
  keys[e.key]=true;
});
addEventListener('keyup',e=>{keys[e.key]=false;});

/* -------------------------
   Update gry
------------------------- */
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
function update(dt){
  if(!gameStarted || gameOver || paused) return;
  const delta=dt/16;
  // ruch
  if(keys['ArrowLeft']||keys['a']) player.x-=player.speed*delta;
  if(keys['ArrowRight']||keys['d']) player.x+=player.speed*delta;
  if(keys['ArrowUp']||keys['w']) player.y-=player.speed*delta;
  if(keys['ArrowDown']||keys['s']) player.y+=player.speed*delta;
  player.x=clamp(player.x,player.width/2,canvas.width-player.width/2);
  player.y=clamp(player.y,player.height/2,canvas.height-player.height/2);

  // pociski
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i]; b.y-=b.speed*delta;
    if(b.y+b.h<0) bullets.splice(i,1);
  }

  // wrogowie
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i]; e.y+=1.2+(enemyHP/60)*0.8;
    e.angle+=0.01; // rotacja dla różnorodności
    // kolizje pocisk <-> wróg
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      if(b.x<e.x+e.width && b.x+b.w>e.x && b.y<e.y+e.height && b.y+b.h>e.y){
        bullets.splice(j,1); e.hp-=20; e.flash=6; soundHit();
        if(e.hp<=0){ score+=100; kills++; xp+=20; if(score>=1000) xp+=30;
          if(xp>=xpGoal){level++; xp-=xpGoal; xpGoal=Math.floor(xpGoal*1.5); soundLevelUp();}
          enemies.splice(i,1);}
        break;
      }
    }
    // kolizja z graczem
    if(!player.shield && player.x-player.width/2<e.x+e.width && player.x+player.width/2>e.x && player.y-player.height/2<e.y+e.height && player.y+player.height/2>e.y){
      enemies.splice(i,1); player.lives-=20; soundDamage();
      if(player.lives<=0){ gameOver=true; gameStarted=false;
        document.getElementById('finalScore').innerText=score;
        document.getElementById('gameover').style.display='flex';
        if(score>highScore){highScore=score; localStorage.setItem('fs_high',highScore);}
      }
    }
    if(e.y>canvas.height+100) enemies.splice(i,1);
  }

  // power-upy
  for(let i=powerUps.length-1;i>=0;i--){
    const p=powerUps[i]; p.y+=1.2; p.pulse+=0.06;
    if(player.x-player.width/2<p.x+p.size && player.x+player.width/2>p.x && player.y-player.height/2<p.y+p.size && player.y+player.height/2>p.y){
      if(p.type==='life'){player.lives=Math.min(player.maxLives,player.lives+20); soundPickup();}
      else if(p.type==='shield'){player.shield=true; shieldTimer=600; soundPickup();}
      else if(p.type==='doubleShot'){doubleShotTimer=600; soundPickup();}
      powerUps.splice(i,1);
    }
    if(p.y>canvas.height+40) powerUps.splice(i,1);
  }

  if(player.shield){shieldTimer--; if(shieldTimer<=0) player.shield=false;}
  if(doubleShotTimer>0) doubleShotTimer--;

  // zapisywanie postępów
  localStorage.setItem('fs_level',level);
  localStorage.setItem('fs_xp',xp);
  localStorage.setItem('fs_xpGoal',xpGoal);
  localStorage.setItem('fs_high',highScore);
}

/* -------------------------
   Rysowanie
------------------------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // tło gradient
  const g=ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,'#071025'); g.addColorStop(1,'#000814');
  ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);

  // linie parallax (jak wcześniej)

  // HUD
  updateHUD();

  // gracz
  const pw=player.width, ph=player.height;
  ctx.fillStyle='rgba(0,0,0,0.35)';
  ctx.fillRect(player.x-pw/2+4,player.y-ph/2+8,pw,ph);
  if(playerImg.complete) ctx.drawImage(playerImg,player.x-pw/2,player.y-ph/2,pw,ph);
  else ctx.fillStyle=player.shield?'#4aa3ff':'#1de9b6'; ctx.fillRect(player.x-pw/2,player.y-ph/2,pw,ph);

  // efekt tarczy
  if(player.shield){ ctx.strokeStyle='#4aa3ff'; ctx.lineWidth=4;
    ctx.beginPath(); ctx.arc(player.x,player.y,player.width,0,Math.PI*2); ctx.stroke(); }

  // pociski, wrogowie, power-upy, paski HP/XP (jak wcześniej, z rotacją wrogów i pulsowaniem power-upów)
}

/* -------------------------
   Game loop
------------------------- */
let last=performance.now();
function frame(now){ const dt=now-last; last=now; update(dt); draw(); requestAnimationFrame(frame); }
requestAnimationFrame(frame);
</script>
</body>
</html>
