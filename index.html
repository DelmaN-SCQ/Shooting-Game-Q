<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Strzelanka 2D — QCoins i sklep</title>
<style>
:root{--bg:#0b0b0f;--panel:#0f1720;--accent:#00e0a8;--muted:#99a0ac;}
html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);color:#e6eef6;}
.wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:18px;box-sizing:border-box;}
.card{width:980px;max-width:calc(100%-36px);background:linear-gradient(180deg,#071018 0%,#08121a 100%);border-radius:12px;box-shadow:0 12px 40px rgba(2,6,23,0.7);padding:14px;display:flex;gap:12px;}
.game-area{position:relative;background:#000;border-radius:8px;overflow:hidden;flex:1;display:flex;align-items:center;justify-content:center;}
canvas{display:block;background:#050607;width:760px;height:540px;}
.panel{width:240px;display:flex;flex-direction:column;gap:10px;}
.title{font-size:16px;font-weight:700;color:var(--accent);}
.stat{background:var(--panel);padding:10px;border-radius:8px;}
.stat .label{font-size:12px;color:var(--muted);}
.stat .value{font-size:18px;margin-top:6px;}
.hpbar{position:absolute;left:50%;transform:translateX(-50%);bottom:12px;width:56%;height:14px;background:rgba(255,255,255,0.04);border-radius:9px;overflow:hidden;}
.hpfill{height:100%;width:100%;background:linear-gradient(90deg,#40ff9d,#00b37a);transition:width 200ms linear;}
#menu, #shopMenu{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:9;background:linear-gradient(180deg, rgba(0,0,0,0.65), rgba(0,0,0,0.5));backdrop-filter:blur(3px);flex-direction:column;gap:10px;}
.menu-box{background:var(--panel);padding:14px 18px;border-radius:10px;text-align:center;min-width:300px;}
.menu-row{display:flex;gap:8px;justify-content:center;margin-top:8px;}
.btn{padding:8px 12px;border-radius:8px;border:none;background:#0b1320;color:#eaf6f0;cursor:pointer;font-weight:600;}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);}
.shop-item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-top:8px;}
.controls{font-size:13px;color:var(--muted);margin-top:6px;}
@media (max-width:980px){.card{flex-direction:column}.panel{width:100%}.game-area{order:1}.panel{order:2}.canvas{width:100%}}
</style>
</head>
<body>
<div class="wrap">
<div class="card">
<div class="game-area" id="gameWrap">
<canvas id="gameCanvas" width="760" height="540"></canvas>
<div class="hpbar" id="playerHPbar"><div class="hpfill" id="hpFill"></div></div>

<div id="menu" class="menu-box">
<div style="font-size:13px;color:var(--muted)">Strzelanka 2D</div>
<h1 style="margin:6px 0 0 0">Start</h1>
<div class="menu-row">
<button class="btn" onclick="startGame()">Graj</button>
<button class="btn" onclick="showShop()">Sklep</button>
</div>
<div style="margin-top:10px;color:var(--muted);font-size:13px">Ruch: WASD lub strzałki, Strzał: Spacja lub klik</div>
</div>

<div id="shopMenu" class="menu-box" style="display:none;">
<h1>Sklep</h1>
<div id="shopItemsPanel"></div>
<div class="menu-row" style="margin-top:12px;">
<button class="btn" onclick="backToMenu()">Powrót</button>
</div>
</div>

</div>
<div class="panel">
<div class="title">Status</div>
<div class="stat"><div class="label">Punkty</div><div class="value" id="score">0</div></div>
<div class="stat"><div class="label">QCoins</div><div class="value" id="qcoins">0</div></div>
<div class="stat"><div class="label">Tarcze</div><div class="value" id="shieldCount">0</div></div>
<div class="stat"><div class="label">Fala</div><div class="value" id="wave">0</div></div>
<div class="stat"><div class="label">Życie (HP)</div><div class="value" id="hpSmall">100</div><div class="controls">Gdy tarcza &gt;0, pociski absorbowane.</div></div>
<div class="title" style="margin-top:6px">Sklep pocisków</div>
<div class="stat" id="shopPanel">
<div style="font-size:13px;color:var(--muted)">Wybierz kolor pocisku (kosmetyczne). Każdy kosztuje QCoins przy pierwszym zakupie.</div>
<div id="shopItems"></div>
</div>
<div class="stat"><div class="label">Sterowanie</div><div class="controls">W/A/S/D lub ←↑↓→ — ruch. Spacja lub klik — strzał.</div></div>
</div>
</div>
</div>
<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
let running=false,score=0,wave=0,shieldCount=0,playerMaxHP=100,playerHP=100,qcoins=0;
const keys={w:false,a:false,s:false,d:false,up:false,down:false,left:false,right:false,space:false};
let player,bullets=[],enemyBullets=[],enemies=[],drops=[],explosions=[];
const MAX_ENEMIES=12;
const shopData=[{id:'yellow',label:'Żółty',color:'#ffe18b',cost:0},{id:'pink',label:'Różowy',color:'#ff9bd1',cost:25},{id:'cyan',label:'Błękitny',color:'#9ef0ff',cost:50},{id:'purple',label:'Fiolet',color:'#cda1ff',cost:90},{id:'gold',label:'Złoty',color:'#ffdc7a',cost:150}];
const storage={get(k,d){try{return JSON.parse(localStorage.getItem(k))||d}catch(e){return d}},set(k,v){try{localStorage.setItem(k,JSON.stringify(v))}catch(e){}}};
let owned=storage.get('ownedBullets',{yellow:true});
let selectedBullet=storage.get('selectedBullet','yellow');
qcoins=storage.get('qcoins',0);

// Input
window.addEventListener('keydown',e=>{if(e.code==='KeyW')keys.w=true;if(e.code==='KeyA')keys.a=true;if(e.code==='KeyS')keys.s=true;if(e.code==='KeyD')keys.d=true;if(e.code==='ArrowUp')keys.up=true;if(e.code==='ArrowLeft')keys.left=true;if(e.code==='ArrowDown')keys.down=true;if(e.code==='ArrowRight')keys.right=true;if(e.code==='Space'){keys.space=true;e.preventDefault();}});
window.addEventListener('keyup',e=>{if(e.code==='KeyW')keys.w=false;if(e.code==='KeyA')keys.a=false;if(e.code==='KeyS')keys.s=false;if(e.code==='KeyD')keys.d=false;if(e.code==='ArrowUp')keys.up=false;if(e.code==='ArrowLeft')keys.left=false;if(e.code==='ArrowDown')keys.down=false;if(e.code==='ArrowRight')keys.right=false;if(e.code==='Space')keys.space=false;});
canvas.addEventListener('click',()=>keys.space=true);

function showShop(){document.getElementById('menu').style.display='none';document.getElementById('shopMenu').style.display='flex';renderShop();}
function backToMenu(){document.getElementById('shopMenu').style.display='none';document.getElementById('menu').style.display='flex';}

// --- Funkcje gry ---
function spawnPlayer(){player={x:canvas.width/2-24,y:canvas.height-90,w:48,h:28,speed:4.2,fireRate:12,fireCooldown:0,shields:0};playerHP=playerMaxHP;updateUI();}
function spawnWave(n){wave++;document.getElementById('wave').textContent=wave;const toSpawn=Math.min(n,MAX_ENEMIES);for(let i=0;i<toSpawn;i++){enemies.push({x:Math.random()*(canvas.width-60),y:-40-i*40,w:40,h:24,speed:0.6+Math.random(),hp:20,maxhp:20,fireCooldown:Math.floor(Math.random()*120),aim:true});}}
function playerShoot(){if(player.fireCooldown>0)return;bullets.push({x:player.x+player.w/2-6,y:player.y-10,w:8,h:14,color:shopData.find(s=>s.id===selectedBullet).color});player.fireCooldown=player.fireRate;}
function updateUI(){document.getElementById('score').textContent=score;document.getElementById('shieldCount').textContent=shieldCount;document.getElementById('wave').textContent=wave;document.getElementById('hpSmall').textContent=Math.max(0,Math.floor(playerHP));document.getElementById('qcoins').textContent=qcoins;const hpPct=Math.max(0,playerHP/playerMaxHP*100);document.getElementById('hpFill').style.width=hpPct+'%';}
function loop(){if(!running)return;update();draw();requestAnimationFrame(loop);}
function update(){
if(keys.w||keys.up)player.y-=player.speed;if(keys.s||keys.down)player.y+=player.speed;if(keys.a||keys.left)player.x-=player.speed;if(keys.d||keys.right)player.x+=player.speed;
player.x=Math.max(0,Math.min(canvas.width-player.w,player.x));player.y=Math.max(0,Math.min(canvas.height-player.h,player.y));
if(keys.space)playerShoot();if(player.fireCooldown>0)player.fireCooldown--;
}
function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.fillStyle='#020305';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle='#00e0a8';ctx.fillRect(player.x,player.y,player.w,player.h);}
function startGame(){document.getElementById('menu').style.display='none';running=true;score=0;wave=0;shieldCount=0;playerHP=playerMaxHP;bullets=[];enemyBullets=[];enemies=[];drops=[];explosions=[];qcoins=storage.get('qcoins',qcoins);spawnPlayer();spawnWave(4);updateUI();loop();}
function renderShop(){const shop=document.getElementById('shopItems');shop.innerHTML='';shopData.forEach(item=>{const ownedFlag=!!owned[item.id];const div=document.createElement('div');div.className='shop-item';const left=document.createElement('div');left.innerHTML=`<div style="font-weight:600">${item.label}</div><div style="font-size:12px;color:var(--muted)">Koszt: ${item.cost} Q</div>`;const right=document.createElement('div');const btn=document.createElement('button');btn.className='btn';btn.style.padding='6px 8px';btn.textContent=ownedFlag?(selectedBullet===item.id?'Wybrany':'Wybierz'):`Kup (${item.cost})`;btn.onclick=()=>{if(ownedFlag){selectedBullet=item.id;storage.set('selectedBullet',selectedBullet);renderShop();}else{if(qcoins>=item.cost){qcoins-=item.cost;owned[item.id]=true;selectedBullet=item.id;storage.set('ownedBullets',owned);storage.set('qcoins',qcoins);storage.set('selectedBullet',selectedBullet);renderShop();updateUI();}else{alert('Brak QCoins');}}};const preview=document.createElement('div');preview.style.width='28px';preview.style.height='16px';preview.style.borderRadius='4px';preview.style.background=item.color;preview.style.marginRight='8px';preview.style.boxShadow='inset 0 0 6px rgba(255,255,255,0.06)';right.appendChild(preview);right.appendChild(btn);div.appendChild(left);div.appendChild(right);shop.appendChild(div);});}
</script>
</body>
</html>
